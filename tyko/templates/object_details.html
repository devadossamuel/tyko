{% extends "details_table.html" %}
{% from "_macros.html" import notes_table_head, notes_table_row, notes_new_button_row, note_editor_events %}
{% from "_details_macros.html" import add_field_row, confirm_remove_entity_modal, child_entity_row, remove_modal_event_scripts %}
{% from "_item_macros.html" import item_new_button_row, new_item_modal %}

{%- block detail_table %}
    <nav class="navbar navbar-expand-lg  navbar-light justify-content-start bg-light">
        <div class="mx-1">
            <a href="{{ url_for('object_pbcore', id=object['object_id']) }}" download>PBCore</a>
        </div>
    </nav>
    <div class="card my-1">
        <div class="card-body">
            <table class="table">
                <caption hidden>Metadata</caption>
                <tbody>
                    {%- for field in fields -%}
                        {{ add_field_row(field.name, field.key, (object.get(field.key) or ""), field.editable, api_path, loop.index) }}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="card my-1">
        <div class="card-header">
            <h5 class="card-title">Items</h5>
        </div>
        <div class="card-body">
            <table class="table">
                <caption hidden>Items</caption>
                {% if "project_id" in object %}
                    <tbody>
                        {% for item in object['items'] %}
                            {{ child_entity_row(
                                item['name'],
                                url_for('page_project_object_item_details', project_id=object['project_id'], object_id=object['object_id'], item_id=item['item_id']),
                                "removeItemModal",
                                url_for("object_item", project_id=object['project_id'], object_id=object['object_id'], item_id=item['item_id'])
                                ) }}
                        {%- endfor -%}
                        {{
                                item_new_button_row(
                                    url_for("project_object_add_item", object_id=object['object_id'], project_id=object['project_id']),
                                    "newItemtModal"
                                )
                        }}
                    </tbody>
                {% endif %}
            </table>
        </div>
        {% if "project_id" in object %}
            {{ new_item_modal("newItemtModal", formats, url_for("project_object_add_item", object_id=object['object_id'], project_id=object['project_id'])) }}
        {% endif %}
        {{ confirm_remove_entity_modal("removeItemModal") }}
    </div>
    <div class="card">
        <h5 class="card-header">Notes</h5>
        <div class="card-body">
            <table class="table">
                <caption hidden>notes</caption>
                {{ notes_table_head(object['notes']) }}
                <tbody>
                    {%- for note in object['notes'] -%}
                        {{ notes_table_row(note, url_for("object_notes", project_id=object['project_id'], object_id=object['object_id'], note_id=note['note_id']) ) }}
                    {%- endfor -%}
                    {{ notes_new_button_row(api_path) }}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {{ remove_modal_event_scripts("removeItemModal") }}
    {% if "project_id" in object %}
        {{ note_editor_events(url_for('project_object', project_id=object['project_id'], object_id=object['object_id']), valid_note_types) }}
    {% endif %}
{% endblock %}